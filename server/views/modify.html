<!DOCTYPE html>

<html>

<head>
	<meta charset="utf-8" />
	<link rel="apple-touch-icon" sizes="152x152" href="/img/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
	<link rel="manifest" href="/img/site.webmanifest">
	<link rel="mask-icon" href="/img/safari-pinned-tab.svg" color="#5bbad5">
	<link rel="shortcut icon" href="/img/favicon.ico">
	<meta name="msapplication-TileColor" content="#da532c">
	<meta name="msapplication-config" content="/img/browserconfig.xml">
	<meta name="theme-color" content="#ffffff">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Coquinaria - Modification Recette</title>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">

	<!-- jQuery library -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

	<!-- Popper JS -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>

	<!-- Latest compiled JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
</head>

<body>
	<header>
		<div id="header"></div>
	</header>

	<div class="container">
		<h1>Modification recette</h1>
		<form method="post" action="/modifierRecette">
			<div class="form-group">
				<label for="cat_rec">- Catégorie de recette</label> :
				<select class="form-control" name="cat_rec">
					<option value="entrees">Entrées</option>
					<option value="plats">Plats</option>
					<option value="biscuits">Biscuits</option>
					<option value="gateaux">Gâteaux</option>
					<option value="boulangerie">Boulangerie</option>
					<option value="sauces">Sauces</option>
				</select>
			</div>
			<div class="form-group">
				<label for="nom_recette">- Nom de la recette</label> : <input type="text" name="nom_recette" placeholder="Ex : poulet au curry"
				 required />
			</div>
			<div class="form-group">
				<label for="temps">- Temps de préparation</label> : <input type="number" name="temps" placeholder="Ex : 5" required />
				min
			</div>
			<div class="form-group">
				<label for="description">- Courte description</label> : <input type="text" name="description" required />
			</div>
			<div class="form-group" id="ing">
				- Ingrédients : <br /><br />
				<button type="button" id="add_ing">Ajouter nouvel ingrédient</button>
				<button type="button" id="supp_ing">Supprimer ingrédient</button>
				<br /><br />
				<input type="text" name="qte_ing" placeholder="3" size="2" required /> <input type="text" name="nom_ing"
				 placeholder="courgettes" required />
				<br /><br />
			</div>
			<div class="form-group">
				<label for="instr">- Instructions</label> : <br /><br />
				<textarea class="form-control" rows="12" name="inst" required></textarea>
			</div>
			<input type="submit" value="Valider" />
		</form>
	</div>

	<script>
		$(document).ready(function () {
			$('#header').load('/navbar.html');
			$("form").attr("action", location.search);
			let url = "/getRecipe" + location.search;
            $.get(url, function(data) {
                if(data) {
					//Refill the fields
                    $("[name='cat_rec']").val(data.info.NAMECATREC);
                    $("[name='nom_recette']").val(data.info.LABREC);
                    $("[name='temps']").val(data.info.TPSREC);
                    $("[name='description']").val(data.info.DESREC);
					$("[name='inst']").val(data.instruction);
					
					// Add the ingredients
                    for(let i = 0 ; i < data.ingredients.length ; i++) {
                        let ing = data.ingredients[i];
                        $("[name='qte_ing']:eq(" + i + ")").val(ing["QTEING"]);
						$("[name='nom_ing']:eq(" + i + ")").val(ing["LABING"]);
						if(i < (data.ingredients.length -1)) {
							$("#add_ing").trigger("click");
						}
                    }

                    return true;
                } else return false;
            });
		});
		
		$('#add_ing').click(function () {
			let html =
				"<input type=\"text\" name=\"qte_ing\" placeholder=\"3\" size=\"2\" required/>	<input type=\"text\" name=\"nom_ing\" placeholder=\"courgettes\" required/>" +
				"<br /><br />";
			$('#ing').append(html);
		});

		$('#supp_ing').click(function() {
			$("#ing :nth-last-child(-n+4)").remove();
		})
	</script>
</body>

</html>