<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="../css/style.css">
    <link rel="apple-touch-icon" sizes="152x152" href="../img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../img/favicon-16x16.png">
    <link rel="manifest" href="../img/site.webmanifest">
    <link rel="mask-icon" href="../img/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="../img/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="../img/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Coquinaria - Recettes - Biscuits</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">

    <!-- Font awesome-->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
</head>

<body>
    <header>
        <div id="header"></div>
    </header>

    <div class="container">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th class="collapse">#</th>
                    <th>Nom</th>
                    <th>Temps de préparation</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                <% if(data.length) {
                        for(var i = 0 ; i < data.length ; i++) { %>
                <tr>
                    <td class="collapse" id="NUMREC<%= i%>">
                        <%= data[i]["NUMREC"]%>
                    </td>
                    <td id="NOMREC<%= i%>">
                        <%= data[i]["LABREC"]%>
                    </td>
                    <td>
                        <%= data[i]["TPSREC"]%> minutes
                    </td>
                    <td>
                        <%= data[i]["DESREC"]%>
                    </td>
                    <td>
                        <a class="btn btn-primary" href="#recipe" onclick="return displayRecipe(<%= i%>);"><i class="fa fa-search"></i></a>
                        <a class="btn btn-danger" href="" onclick="return deleteRecipe(<%= i%>);"><i class="fa fa-trash"></i></a>
                    </td>
                </tr>
                <% }
                        } else { %>
                <tr>
                    <td colspan="3">Aucune recette</td>
                </tr>
                <% } %>
            </tbody>
        </table>
    </div>

    <div class="container" id="recipe">
        <hr width="auto" />
        <div class="collapse" id="name-recipe">
            <h3 class="fg-dark">
                Nom de la recette :
            </h3>
            <div id="name">
                
            </div>
            <br />
        </div>
        <div class="collapse" id="ingredients-recipe">
            <h3 class="fg-dark">
                Ingrédients :
            </h3>
            <ul id="ingredients">
                
            </ul>
            <br />
        </div>
        <div class="collapse" id="instructions-recipe">
            <h3 class="fg-dark">
                Instructions :
            </h3>
            <div id="instructions">
                
            </div>
            <br />
        </div>
    </div>

    <script>
        $(document).ready(function () {
            $('#header').load('../navbar.html');
        });

        function displayRecipe(val) {
            var url = "/getRecipe/" + parseInt($('#NUMREC' + val).html().trim());
            $.get(url, function(data) {
                if(data) {
                    $('#name-recipe').removeClass("collapse");
                    $('#ingredients-recipe').removeClass("collapse");
                    $('#instructions-recipe').removeClass("collapse");

                    // Empty the list of ingredients
                    $('#ingredients').html("");

                    // Add the ingredients
                    for(var i = 0 ; i < data.ingredients.length ; i++) {
                        var ing = data.ingredients[i];
                        $('#ingredients').append("<li>" + ing["amount"] + " " + ing["name"] + "</li>");
                    }

                    $('#name').html($('#NOMREC' + val).html().trim());
                    $('#instructions').html(data.instruction);
                    return true;
                } else return false;
            });
        }

        function deleteRecipe(val) {
            if(confirm("Souhaitez-vous vraiment supprimer cette recette ?")) {
                var url = "/removeRecipe/" + parseInt($('#NUMREC' + val).html().trim());
                $.ajax({url: url, async: false, method: 'POST'}, function(data) {
                    if(data.result) {
                        $('#NUMREC' + val).remove();
                    } else {
                        alert("Erreur lors de la modification");
                    }
                });
            }
        }
    </script>
</body>

</html>